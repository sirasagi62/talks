## 1 自己紹介

こんにちは、sirasagi62です。私は仙台に住んでいる大学生です。VimとNeovimを使い始めてかれこれ10年近く経ちます。

## 2 Hooks

今日は「Finder」の話をしたいと思います。ご存知のように、NeovimとVimにはたくさんのファジーファインダーがあります。telescope,fern,fzf.vim

きっとみなさんは次のように思っているでしょう。

## 3 Hooks2

「またFuzzyFinderか!」

でも今回は違います。

## 4 Hook3

今日、私は新しいカタチのファインダー、”Fluent” Finderを紹介したいと思います。

## 5 Motivation

プログラミングにおいてコードを探すというのは非常に大変ですよね？頭の中でキーワードを思い浮かべてgrepしようとして、次のような経験をしたことがあるはずです。

「同じ意味の別の動詞でずっと探していて機能が見つからなかった」

「そもそもどういう単語で探したらいいかが思い浮かばない」

Fuzzy Finderは単語のファジーマッチングに基づいて検索するため、同義語での検索や文章での検索は行うことができません。

残念ながらAIがコードを書いてくれる昨今でも、コードを読む作業はなくらないでしょう。したがって、この問題とも当面付き合う必要があるのです。

## 6 What is Fluent Finder

この問題を解決するのがFluent Finderです。Fluent Finderは単純な文字列照合ではなく言語モデルによるベクトル検索でテキストを探します。つまり、コードの意味をAIが理解し、表面的なテキストにとらわれることなくコード検索します。

コードの解析にはTree-sitterを用いることで様々な言語で動作するようにしています。

## 7 Example

では実際に例を見てみましょう。”FlfDir”コマンドではディレクトリ内のコードを再帰的に解析します。日本語で”データベースを閉じる”と入力すると、実際に”deInit”関数を表示しているのがわかります。”データベース”それから”閉じる”という単語を理解して適切な関数を選択できているのです。

## 8 Problem

しかし、”FlfDir”には大きな問題があります。コードの量が大きくなるとindexingに非常に時間がかかるのです。計算した結果、例えばVim本体のコードを分析しようとするとindexingだけで1時間以上もかかってしまうのです。これでは”Fluent”とはいえませんね。

## 9 Example2

そこでもう１つのコマンド、”FlfBuf”を開発しました。このコマンドではプロジェクトディレクトリ全体を検索する代わりに開いているバッファのみを検索対象に動くするようにしました。

このGIFではVimのソースコードを開いたバッファをインデクシングして検索しています。”文字列の大きさ”という日本語から`strsize`関数が引けています。検索対象を限定することで、現実的な時間でインデクシングできるようになりました。

## 10 Embedding Model

FlfはローカルSLMを用います。APIを呼ばないから、セキュリティ的にも安全だし、コストも安く抑えられますもちろん。パラメータ数も非常に少ないので少なくともmacbookではかなり高速に動作します。

今回利用したモデルは”ruri”という名古屋大学で開発されたモデルをファインチューンした”ruri-v3-70m-code-v-0.1”というものです。

開発者の名前はtokinasinというそうです。この名前、どこかで見覚えがある気がしますね。

## More things…

話したいことはまだまだあるんです。「Vimのバッファコマンドのバグか仕様か判然としない動作」「開発途中で見つけたbunを4行でクラッシュさせるバグ」「Flf本体のコマンドと通信しながらVimとNeovimの両方に対応させるハック」…

でも残念ながら5分はこれらを語るにはあまりにも短すぎるね！

聞いてくれてありがとう！
